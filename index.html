<!DOCTYPE html>
<html lang="en">
    
    <head>
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        
        <title>Javascript Calculator</title>
        
        <!-- Fontawesome -->
        <script src="https://use.fontawesome.com/780ce05cc4.js"></script>
        
        <!-- Styles -->
        <link rel="stylesheet" href="style.css">
        
    </head>
    
    <body>
        
        <div class="container">
            <div class="calc-container">
                <div class="display">
                    <div class="result-container"><p class="result">0</p></div>
                </div>
                <div class="breadcrumbs">
                    <div class="crumb-wrapper crumb-wrapper-0">
                    </div>
                </div>
                <div class="keypad">
                    <p class="button keypad-button one" id="1">1</p>
                    <p class="button keypad-button two" id="2">2</p>
                    <p class="button keypad-button three" id="3">3</p>
                    <p class="button keypad-button four" id="4">4</p>
                    <p class="button keypad-button five" id="5">5</p>
                    <p class="button keypad-button six" id="6">6</p>
                    <p class="button keypad-button seven" id="7">7</p>
                    <p class="button keypad-button eight" id="8">8</p>
                    <p class="button keypad-button nine" id="9">9</p>
                    <p class="button keypad-button neg" id="-">&mnplus;</p>
                    <p class="button keypad-button zero" id="0">0</p>
                    <p class="button keypad-button period" id=".">&period;</p>
                </div>
                <div class="operators">
                    <p class="button operator-button divide" id="/">&div;</p>
                    <p class="button operator-button minus" id="-">&minus;</p>
                    <p class="button operator-button plus" id="+">&plus;</p>
                    <p class="button operator-button times" id="*">&times;</p>
                </div>
                <div class="back-eval">
                    <p class="button back-eval-button back" id="back">&lt; Back</p>
                    <p class="button back-eval-button evaluate" id="=">&equals;</p>
                </div>
            </div>
        </div>
        
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
        
        <script type="text/javascript">
            
            // initialize variables
            var equalClicks = 0; // keep track of number of "=" clicks
            var expression = ""; // initialize expression
            var breadcrumb = ""; // initialize breadcrumb
            var resultLog = [""]; // keep track of result
            var keysPressed = ""; // keep track of keys pressed
            
            // function to add breadcrumbs
            function addCrumb() {
                $(".crumb-wrapper-" + equalClicks).css("display", "flex");
                console.log("add breadcrumb: " + breadcrumb);
                var html = "";
                for (i=0; i<breadcrumb.length; i++) {
                    html = html + "<div class='crumb'>" + breadcrumb[i] + "</div>"
                }
                console.log(html);
                $(".crumb-wrapper-" + equalClicks).html(html);
            }
            
            // last item
            function lastThing(keysPressed) {
                var re = /[\/\+\-\*]/;
                var array = keysPressed.split(re);
                console.log(array);
            }
            
            // Main script
            
            $(document).ready(function() {
                
                console.log("Equal button clicks: " + equalClicks);
                
                // update expression on click
                $(".one").click(function() {
                    console.log(event.target.id);
                    expression += event.target.id;
                    breadcrumb += event.target.id;
                    keysPressed += event.target.id;
                    addCrumb();
                });
                $(".two").click(function() {
                    console.log(event.target.id);
                    expression += event.target.id;
                    breadcrumb += event.target.id;
                    keysPressed += event.target.id;
                    addCrumb();
                });
                $(".three").click(function() {
                    console.log(event.target.id);
                    expression += event.target.id;
                    breadcrumb += event.target.id;
                    keysPressed += event.target.id;
                    addCrumb();
                });
                $(".four").click(function() {
                    console.log(event.target.id);
                    expression += event.target.id;
                    breadcrumb += event.target.id;
                    keysPressed += event.target.id;
                    addCrumb();
                });
                $(".five").click(function() {
                    console.log(event.target.id);
                    expression += event.target.id;
                    breadcrumb += event.target.id;
                    keysPressed += event.target.id;
                    addCrumb();
                });
                $(".six").click(function() {
                    console.log(event.target.id);
                    expression += event.target.id;
                    breadcrumb += event.target.id;
                    keysPressed += event.target.id;
                    addCrumb();
                });
                $(".seven").click(function() {
                    console.log(event.target.id);
                    expression += event.target.id;
                    breadcrumb += event.target.id;
                    keysPressed += event.target.id;
                    addCrumb();
                });
                $(".eight").click(function() {
                    console.log(event.target.id);
                    expression += event.target.id;
                    breadcrumb += event.target.id;
                    keysPressed += event.target.id;
                    addCrumb();
                });
                $(".nine").click(function() {
                    console.log(event.target.id);
                    expression += event.target.id;
                    breadcrumb += event.target.id;
                    keysPressed += event.target.id;
                    addCrumb();
                });
                $(".neg").click(function() {
                    console.log(event.target.id);
                    expression += event.target.id;
                    breadcrumb += event.target.id;
                    keysPressed += event.target.id;
                    addCrumb();
                });
                $(".zero").click(function() {
                    console.log(event.target.id);
                    expression += event.target.id;
                    breadcrumb += event.target.id;
                    keysPressed += event.target.id;
                    addCrumb();
                });
                $(".period").click(function() {
                    if (!/\./.test(keysPressed[keysPressed.length-1])) {
                        console.log(event.target.id);
                        expression += event.target.id;
                        breadcrumb += event.target.id;
                        keysPressed += event.target.id;
                        addCrumb();
                    }
                });
                $(".divide").click(function() {
                    if (!/[\/\+\-\*]/.test(keysPressed[keysPressed.length-1])) {
                        console.log(event.target.id);
                        expression += event.target.id;
                        breadcrumb += event.target.id;
                        keysPressed += event.target.id;
                        addCrumb();
                    }
                });
                $(".minus").click(function() {
                    if (!/[\/\+\-\*]/.test(keysPressed[keysPressed.length-1])) {
                        console.log(event.target.id);
                        expression += event.target.id;
                        breadcrumb += event.target.id;
                        keysPressed += event.target.id;
                        addCrumb();
                    }
                });
                $(".plus").click(function() {
                    if (!/[\/\+\-\*]/.test(keysPressed[keysPressed.length-1])) {
                        console.log(event.target.id);
                        expression += event.target.id;
                        breadcrumb += event.target.id;
                        keysPressed += event.target.id;
                        addCrumb();
                    }
                });
                $(".times").click(function() {
                    if (!/[\/\+\-\*]/.test(keysPressed[keysPressed.length-1])) {
                        console.log(event.target.id);
                        expression += event.target.id;
                        breadcrumb += event.target.id;
                        keysPressed += event.target.id;
                        addCrumb();
                    }
                });
                
                // evaluate expression
                $(".evaluate").click(function(e) {
                    
                    if (expression) { // equal button does nothing if no buttons have been clicked
                                
                        var newResult = "";
                        var lastResult = resultLog[resultLog.length-1];

                        // evaluate the expression and display it
                        console.log("Evaluating...");
                        console.log(" last result: " + lastResult);
                        console.log(" new expression: " + expression);
                        console.log(" combine: " + lastResult + expression);

                        newResult = eval(lastResult + expression);

                        $(".result").empty().html(newResult);

                        console.log("RESULT: " + newResult);

                        // reset variables
                        expression = "";
                        breadcrumb = "";

                        // add current result to resultLog array
                        resultLog.push(newResult);

                        // increment the number of equal clicks by one
                        equalClicks++;
                        console.log("Equal button clicks: " + equalClicks);

                        // add new breadcrumb div to accept the next breadcrumb
                        $(".breadcrumbs").append("<div class='crumb-wrapper crumb-wrapper-" + equalClicks + "'></div>"); 
                        $(".crumb-wrapper-" + equalClicks).css({"display":"none", "background-color":"#68cef2"});
                    }
                });
                
                // go back
                $(".back").click(function() {
                    
                    if (equalClicks > 0) {
                    
                        // if equal was clicked before going back, remove the blank div added by clicking on equal
                        if ($(".crumb-wrapper-" + equalClicks).text() == "") {
                            // remove most recent breadcrumb
                            $(".crumb-wrapper-" + equalClicks).remove();
                            // decrement the number of equal clicks by 1
                            equalClicks--;
                        }

                        console.log($(".crumb-wrapper-" + equalClicks));

                        // remove the most recent breadcrumb
                        $(".crumb-wrapper-" + equalClicks).remove();

                        // revert to previous result and display it
                        resultLog.pop(); // remove last result from array
                        if (resultLog == "") { // check if array is empty
                            // display 0
                            $(".result").empty().html(0);
                        } else {
                            // display last result
                            var resetResult = resultLog[resultLog.length-1];
                            $(".result").empty().html(resetResult);
                        }

                        // reset breadcrumb
                        breadcrumb = "";

                        // add new breadcrumb div to accept the next breadcrumb
                        $(".breadcrumbs").append("<div class='crumb-wrapper crumb-wrapper-" + equalClicks + "'></div>"); 
                        $(".crumb-wrapper-" + equalClicks).css({"display":"none", "background-color":"#68cef2"});

                        console.log("You have moved back one step");
                        console.log("Equal clicks have been reset to " + equalClicks);
                        console.log("The result has been reset to: " + resetResult);
                
                    }
                    
                });

            });
            
        </script>
        
    </body>
    
</html>